<div class="row">
  <div class="col-3">
    <h2>Friends</h2>
    <form [formGroup]="friendForm" (ngSubmit)="onSubmitFriendForm(friendForm.value)">
      <div class="form-group">
        <label for="friendFormInputName">Friend Name</label>
        <input id="friendFormInputName" class="form-control" formControlName="name" type="text" placeholder="Albert" />  
      </div>
      <button type="submit" class="btn btn-primary">Add</button>
    </form>

    <div class="mt-3">
      <ul class="list-group">
        <li *ngFor="let friend of friends" class="list-group-item">
          {{ friend.name }}
        </li>
      </ul>
    </div>
  </div>

  <div class="col-3">
    <h2>Items</h2>
    <form [formGroup]="itemForm" (ngSubmit)="onSubmitItemForm(itemForm.value)">
      <div class="form-group">
        <label for="itemFormInputName">Item Name</label>
        <input id="itemFormInputName" class="form-control" formControlName="name" type="text" placeholder="Cheese Pizza" />
      </div>
      <div class="form-group">
        <label for="itemFormInputPrice">Item Price</label>
        <input id="itemFormInputPrice" class="form-control" formControlName="price" type="text" placeholder="150" />
      </div>
      <button type="submit" class="btn btn-primary">Add</button>
    </form>
    <table class="table mt-3">
      <thead class="thead-light">
        <tr>
          <th scope="col">Name</th>
          <th scope="col">Shared by</th>
          <th scope="col" class="text-right">Price</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of items">
          <td>{{ item.name }}</td>
          <td>
            <div *ngIf="editItemSharerId !== item.id; else editItemSharer">
              {{ getFriendName(item.sharer_ids) }}
              <button class="btn btn-primary" (click)="onEditItemSharer(item.id)">Edit</button>  
            </div>
            <ng-template #editItemSharer>
              <ul class="list-group">
                <li *ngFor="let friend of friends" class="list-group-item">
                  <label>
                    <input type="checkbox" [checked]="item.sharer_ids.includes(friend.id)" (change)="onChangeItemSharer(item.sharer_ids, friend.id, $event)" />
                    {{ friend.name }}                      
                  </label>
                </li>
              </ul>
            </ng-template>
          </td>
          <td class="text-right">{{ item.price }}</td>
        </tr>
        <tr class="table-primary">
          <td colspan="2">Total</td>
          <td class="text-right">{{ totalPrice }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="col-3">
    <h2>Paid By</h2>
    <form [formGroup]="payerForm" (ngSubmit)="onSubmitPayerForm(payerForm.value)">
      <div class="form-group">
        <label for="payerFormPayerId">Payer</label>
        <select id="payerFormPayerId" class="form-control" formControlName="payer">
          <option *ngFor="let friend of friends" [value]="friend.id" >{{ friend.name }}</option>
        </select>
      </div>
      <div class="form-group">
        <label for="payerFormPayment">Payment</label>
        <input id="payerFormPayment" class="form-control" formControlName="payment" type="text" />
      </div>
      <button type="submit" class="btn btn-primary">Add</button>
    </form>
    <div class="mt-3">
      <ul class="list-group">
        <li *ngFor="let payer of payers" class="list-group-item">
          {{ friendById[payer.payerId].name }} - {{ payer.payment }}
        </li>
      </ul>
    </div>
  </div>

  <div class="col-3" *ngIf="isPaymentCompleted">
    <h2>Settlement</h2>
    <div class="mt-3">
      <ul *ngIf="debts.length > 0; else nothingToSettle" class="list-group">
        <li
          *ngFor="let debt of debts"
          class="list-group-item"
          [ngClass]="debt.amount > 0 ? 'list-group-item-warning' : 'list-group-item-success'">
          {{ friendById[debt.owerId].name }} is
          {{ debt.amount > 0 ? 'owed' : 'owing' }}
          {{ debt.amount | abs }}
        </li>
      </ul>
      <ng-template #nothingToSettle>
        All Clear!
      </ng-template>
    </div>
  </div>
</div>
